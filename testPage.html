
<!DOCTYPE html> 
<html lang="en" style="width: 100%; height: 100%"> 
<head> 
<meta charset="utf-8" /> 
<meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" /> 
<style type="text/css">
#test_image{
	display: block;
	margin-left: auto;
	margin-right: auto;
}
div{
	margin-left: auto;
	margin-right: auto;
	display: block;
	text-decoration: none;
	font-family: sans-serif;
}
.test_text{
	font-size: 93%;
	margin-left: auto;
	margin-right: auto;
	display: block;
	width:30%;
}
.accent{
	margin-left: auto;
	margin-right: auto;
	display: block;
	width:30%;
}
.radiobuttons{
	font-size: 80%; 
}
#test{
	width:100%;
	height:600px;

}

button{
	display: block;
	margin-left: auto;
	margin-right: auto;
	width: 200px;
	height: 75px;
	top: 602px;
	z-index: 400;
}
#graph{
	position: absolute;
	display: block;
	top: 700px;
	left: 700px;
	z-index: -1;
}

</style> 
</head> 


<body class="center" style="width: 100%; height: 100%">  

<div style="width: 100%; height: 100%; position: absolute; z-index: 50" id="divMain">
	<div id="test">
		<img id="test_image" src="bird2.jpg" align="middle"></img>
		<br><br>
		<div class = 'accent' id='accent1'>1:28</div>
		<div class='test_text'>And the most cunning of them all was this small man. His toes were taut in the wet sand as he scanned the horizon, trying to anticipate where the great beast would breach the waves. </div>
		<br>
		<div class = 'accent' id='accent2'>4:24</div>
		<div class='test_text'>When members of the enclave first encountered the tome, few could have guessed that it would inspire modern shariah law. Only when supreme leader Khameni interpreted the text did young Zohran know how serious the reprisals would be. </div> 
	</div>
	<div>
		<button id ='go'>Go</button>
		<canvas id='graph'></canvas>
		<br><br>
	</div>
	<div style="width: 100%; height: 100%; position: absolute; z-index: 0" id="divMain">
	<div>
		Speed: <label id ='timer'>The flexors are gurgling</label> seconds
		<br><br>
	</div>
	<div>
		Total clusters to choose from:
		<input type="text" name="numberOfClusters" value="24" id="clusterCount">
		<br><br>
	</div>
	<div>
		Resolution:
		<input type="text" name="resolution" value="auto" id="resolution">
		<br><br>
	</div>
	<div>
		Minimum brightness(value) differential between background and text:
		<input type="text" name="threshold" value="auto" id="resolution">
	</div>
	<div>
		<h2>Reference color</h2>
		<input type="radio" name="reference" style="z-index: 60;"> Background </input>
		<input type="radio" name="reference" style="z-index: 60;"> Highlight one </input>
		<input type="radio" name="reference" style="z-index: 60;"> Highlight two </input>
	</div>
	<div>
		<h2>Relationship to reference color</h2>
		<input type="radio" name="relationship" style="z-index: 60;"> None </input>
		<input type="radio" name="relationship" style="z-index: 60;"> Complimentary </input>
		<input type="radio" name="relationship" style="z-index: 60;"> Tertiary</input>
	</div>
	
	<div class="radiobuttons">
		<h1>highlight one:</h1>
		<input type="radio" name="highlight1" style="z-index: 60;"> Largest cluster</input>
		<input type="radio" name="highlight1" style="z-index: 60;"> smallest cluster</input>
		<input type="radio" name="highlight1" style="z-index: 60;"> least varied cluster</input>
		<input type="radio" name="highlight1" style="z-index: 60;"> most varied cluster</input>
		<h3>Color offset</h3>
		<input type="radio" name="highlightoffsettype" style="z-index: 60;">add</input>
		<input type="radio" name="highlightoffsettype" style="z-index: 60;">multiply</br>
		Hue: <input type="text" name="h1" value="0">
		Saturation: <input type="text" name="s1" value="0">
		Value: <input type="text" name="v1" value="0">
		
	</div>
	<div class="radiobuttons">
		<h1>highlight two:</h1>
		<input type="radio" name="highlight2" style="z-index: 60;"> Largest cluster</input>
		<input type="radio" name="highlight2" style="z-index: 60;"> smallest cluster</input>
		<input type="radio" name="highlight2" style="z-index: 60;"> least varied cluster</input>
		<input type="radio" name="highlight2" style="z-index: 60;"> most varied cluster</input>
		<h3>Color offset</h3>
		<input type="radio" name="highlightoffsettype" style="z-index: 60;"align="middle">add</input>
		<input type="radio" name="highlightoffsettype" style="z-index: 60;"align="middle">multiply</br>
		Hue: <input type="text" name="h2" value="0">
		Saturation: <input type="text" name="s2" value="0">
		Value: <input type="text" name="v2" value="0">         
		
		
	</div>
	<div class="radiobuttons">
		<h1>background:</h1>
		<input type="radio" name="background" style="z-index: 60;"> Largest cluster</input>
		<input type="radio" name="background" style="z-index: 60;"> smallest cluster</input>
		<input type="radio" name="background" style="z-index: 60;"> least varied cluster</input>
		<input type="radio" name="background" style="z-index: 60;"> most varied cluster</input>
		<h3>Color offset</h3>
		<input type="radio" name="highlightoffsettype" style="z-index: 60;"align="center">add</input>
		<input type="radio" name="highlightoffsettype" style="z-index: 60;" align="center">multiply</br>
		Hue: <input type="text" name="h3" value="0">
		Saturation: <input type="text" name="s3" value="0">
		Value: <input type="text" name="v3" value="0">         
		
	</div>
	
	
</div>


<script type="text/javascript" src='figue.js'></script>
<script type="text/javascript" src='autoStyle.js'></script>
<script type="text/javascript">
var goButton = document.getElementById('go');
var timer = document.getElementById('timer');
goButton.onclick = function(){
	analyse()
}
var dropbox = document.getElementById('test_image');
analyse();
// Setup drag and drop handlers. 
dropbox.addEventListener('dragenter', stopDefault, false); 
dropbox.addEventListener('dragover', stopDefault, false); 
dropbox.addEventListener('dragleave', stopDefault, false); 
dropbox.addEventListener('drop', onDrop, false); 

function stopDefault(e)  
	{ 
	  e.stopPropagation(); 
	  e.preventDefault(); 
	}

function drawGraph(ctxdraw,clusters){
		ctxdraw.clearRect(0,0,300,150);
	for (var i = clusters.centroids.length - 1; i >= 0; i--) {
		h = clusters.centroids[i][0];
		s = clusters.centroids[i][1];
		v = clusters.centroids[i][2];
	    console.log(clusters);
		rgb =  [h,s,v];
		rad = 300*clusters.clusterSizes[i]/clusters.assignments.length;

		ctxdraw.fillStyle = "rgb("+Math.floor(rgb[0])+","+Math.floor(rgb[1])+","+Math.floor(rgb[2])+")";
		var width = (300/clusters.centroids.length)-2;
		ctxdraw.fillRect(i*width, 150 - rad, width-1, rad);
	}
} 

function analyse(){
	var start = new Date().getTime();
	var clusterCount = document.getElementById('clusterCount').value;
	var resolution = document.getElementById('resolution').value;  
	var photoInfo = autoStyle.getClusters(clusterCount,dropbox,resolution);
	var clusters = photoInfo.clusters;
	var colors = autoStyle.processClusters(photoInfo,2,1,0);
	var highlight1 = colors.highlight1color;
	var highlight2 = colors.highlight2color;
	var background = colors.backgColor;
	console.log(colors);
	console.log('$$$$');
	var pickedColors = {'highlight1':highlight1,'highlight2':highlight2}
	var finish = new Date().getTime();
	var drawCanvas = document.getElementById('graph');
	var ctxdraw = drawCanvas.getContext('2d');
	document.getElementById('test').style.background = "rgb("+Math.floor(background[0])+","+Math.floor(background[1])+","+Math.floor(background[2])+")";
	document.getElementById('test').style.color = "rgb("+Math.floor(highlight2[0])+","+Math.floor(highlight2[1])+","+Math.floor(highlight2[2])+")";
	document.getElementById('accent1').style.color = "rgb("+Math.floor(highlight1[0])+","+Math.floor(highlight1[1])+","+Math.floor(highlight1[2])+")";
	document.getElementById('accent2').style.color = "rgb("+Math.floor(highlight1[0])+","+Math.floor(highlight1[1])+","+Math.floor(highlight1[2])+")";
	timer.innerHTML = ((finish - start)/1000);
	drawGraph(ctxdraw,clusters);
	//console.log(photoInfo);
}

function onDrop(e)  
{
	console.log("dropped"); 
	e.stopPropagation(); 
	e.preventDefault(); 

	var readFileSize = 0; 
	var files = e.dataTransfer.files; 
	console.log(files);
	file = files[0]; 
	readFileSize += file.fileSize; 


	// Only process image files. 
	var imageType = /image.*/; 

	if (!file.type.match(imageType))  
	{ 
		return; 
		} 


	var reader = new FileReader(); 


	reader.onerror = function(e)  
	{ 
		alert('Error code: ' + e.target.error); 
	}; 


	// Create a closure to capture the file information. 
	reader.onload = (function(aFile)  
	{ 
	return function(evt)  
	{ 
		dropbox.src = evt.target.result; 

	} 
	})(file); 

	// Read in the image file as a data url. 
	reader.readAsDataURL(file); 

} 
</script>